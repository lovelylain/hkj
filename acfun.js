/*!
 * 修改自AcFun助手(http://acnya.github.io/script.js)
 * 基于https://github.com/daily2432121/acnya.github.io/blob/master/script.js修改
 * 因为某晚才知道有这好东西然后添加了书签，第二天原地址就404了，好容易找到这个备份
 */
(function(){if(!system.func.setPlayer){(function(){system.func.setPlayer=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;a=$$("#area-part-view"),c=$('<iframe id="ACFlashPlayer-re"></iframe>'),d=system.browser.postmessage?1:0,f=$.mid();if(!a.length)return $.info("error::视频信息错误。请反馈管理员处理。");switch(e=system.func.checkFlash,j="小贴士："+$.rnd(["右键点击视频中的弹幕可以屏蔽发送该弹幕用户的所有弹幕。","播放器右下的四个按钮依次是屏蔽弹幕、循环视频、详细设置和全屏播放。","打开右侧弹幕列表后，可以在列表下方开启合并重复弹幕、连播模式等功能。","“更多设置项”里可以设置更多功能，也可以使用更细致的屏蔽功能。","点击弹幕发送条左侧的“A”字按钮可以设置弹幕大小、模式和字色。","播放器下方的分享功能可以把你喜欢的视频分享到微博、qq空间、贴吧和人人网。","视频右上方有收藏、点赞和跳到评论区功能，多利用它们让up主获得更多支持吧。","如有发现广告、人身攻击等违规弹幕，可以通过右键举报功能通知管理员处理。","如果发现感兴趣的系列类投稿，可以通过关注up主的方式获得最新更新推送。","对UP主的最好支持就是多发弹幕多评论，并且在收藏后给UP主“投个食”！","双击播放画面即可进入或退出全屏播放。","按下“↑”和“↓”键即可调节音量。音量最高可达500%25。","按下“←”和“→”键即可后退或前进一小段。","播放器会自动记录你的每一次操作。",'在"更多设置项"中可以设置弹幕的透明度。',"“弹幕”的正确发音是“dan4 mu4”，而不是“tan2 mu4”，不要念错了哟。"]),m=system.post.vid=0|((g=$("#area-part-view a.btn.active:eq(0)").data()).vid||131797),k=system.post.sid=g.sid,i=system.post.from=g.from){case"youku":case"qq":case"youku2":case"qq2":case"letv2":case"sohu":case"pptv":return $$("#ACFlashPlayer-re").flash({path:"https://ssl.acfun.tv/flash/CoopPlayer.swf"+$.salt(7),width:"100%",height:"100%",flashvars:{type:i.replace(/2/,""),sourceId:k,videoId:m,vid:k,autoPlay:1},params:{scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"#000000"}}),$$("#area-player").removeAttr("style");case"iqiyi":return b=k.split(":"),h={path:"http://www.iqiyi.com/common/flashplayer/20140807/CoopPlayer.swf"+$.salt(7),width:"100%",height:"100%",flashvars:{type:"iqiyi",sourceId:b[0],videoId:m,autoPlay:1,oldcs:1,tvId:b[1]||null},params:{scale:"noScale",allowFullscreen:"true",allowScriptAccess:"always",bgcolor:"#000000"}},b[2]&&"1"===b[2]&&(h.flashvars.bd=1),$$("#ACFlashPlayer-re").flash(h),$$("#area-player").removeAttr("style");default:if($("iframe#ACFlashPlayer-re").length||($("#ACFlashPlayer-re").remove(),$$("#area-player .inner").prepend(c),c.css({visibility:"visible"})),c.attr({src:""}),l=system.path.ssl+"/block-player-"+(e()?"homura":"madoka")+".html"+$.salt(1)+"#token="+f+";vid="+m+";postMessage="+d+";autoplay="+(system.hash&&(system.hash.autoplay||system.hash.fullscreen)?1:0)+";fullscreen="+((null!=(n=system.hash)?n.fullscreen:void 0)?1:0)+";from="+system.path.base+(system.debug?";debug=true":"")+";hint="+j+(e()?"":";title="+system.post.title+(system.post.name||"")),system.hash.autoplay&&!system.hash.fullscreen&&$$("#area-player").scrollOnto(0),setTimeout(function(){return c.attr({src:l})},50),!c.data().resize)return c.removeAttr("data-src").removeAttr("data-from").data({resize:function(){return clearTimeout(c.data().timer),c.data().timer=setTimeout(function(){var a,b,d,e,f;return f=$(window).innerWidth(),e=$(window).innerHeight(),d=f>=1410?1200:980,a=1200===d?e>900?715:592:e>768?592:520,c.data().float?(c.parent().css({left:$$("#area-right-bottom").offset().left}),$$("#area-player").css({width:d,height:a})):c.data().fullscreen?(b=$$("#area-player>div.inner"),$$("#stage").css({height:e}).scrollOnto(0),c.data({width:f,height:e}).css({width:f,height:e,left:-b.offset().left,top:-b.offset().top,"z-index":255})):d!==c.data().width||a!==c.data().height?c.data({width:d,height:a}).add("#area-player").css({width:d,height:a,left:0,top:0}):void 0},50)}}),$(window).resize(c.data().resize),c.data().resize()}}})()}if($("html").data().achelper||system.type!="video"){return}else{$("html").data().achelper=true}if(!config.plugins||!config.plugins.acHelper){config.plugins={acHelper:{autoSwap:true,autoHide:false,html5:false}};$.save("config")}else if(typeof config.plugins.acHelper.autoSwap!="boolean"){config.plugins.acHelper.autoSwap=true}part=$("#area-part-view .btn.active");if(config.plugins.acHelper.html5){system.func.checkFlash=function(){return false}}var funcAutoSwap=function(){if(config.plugins.acHelper.autoSwap){if($.inArray($("#area-part-view .btn.active").data().from,["youku2","qq2","letv2","sohu","pptv","iqiyi"])!==-1){var timer=setInterval(function(){if($("object#ACFlashPlayer-re").length){$("#area-part-view .btn.active").data().from="acer";system.func.setPlayer();clearInterval(timer)}else if($("#area-redirect").length){$("#area-player .inner").html('<iframe id="ACFlashPlayer-re"></iframe>');if(system.func.readyPlayer){$("#area-part-view .btn.active").data().from="acer";system.func.readyPlayer()}clearInterval(timer)}},500)}else if(config.plugins.acHelper.html5){system.func.setPlayer()}}};if($("#area-part-view .btn.active").length){funcAutoSwap()}else{var partTimer=setInterval(function(){if($("#area-part-view .btn.active").length){funcAutoSwap();clearInterval(partTimer)}},500)}var style=document.createElement("style");$(style).html('#area-toolbar-view{z-index:3 !important;}#area-toolbar-view:hover .tooltip{display:inline-block}#area-toolbar-view .icon{transition:color .5s}#area-toolbar-view .tooltip{display:none;background-color:#fff;font-family:"Microsoft Jhenghei",Helvetica,Arial,Verdana,sans-serif;color:#666;text-shadow:0 0 2px rgba(0,0,0,0.1);font-size:18px;padding:0 10px;border-left:1px solid #ddd;height:34px;border-right:1px solid #ddd;position:absolute;left:395px;}#area-toolbar-view .tooltip .icon{color:#3a9bd9}#area-toolbar-view .tooltip:hover + .config-box{display:block}#area-toolbar-view .tooltip:hover .icon{color:#95be3e}#area-toolbar-view .config-box{display:none;position:absolute;background:rgba(255,255,255,0.75);box-shadow:2px 4px 4px rgba(0,0,0,0.1);border:1px solid #ddd;top:34px;left:395px;width:300px;height:180px;}#area-toolbar-view .config-box p,#area-toolbar-view .config-box a,#area-toolbar-view .config-box span,#area-toolbar-view .config-box label{font-family:"Microsoft Jhenghei",Helvetica,Arial,Verdana,sans-serif}#area-toolbar-view .config-box:hover{display:block}#area-toolbar-view .config-box .inner{padding:8px;}#area-toolbar-view .config-box .inner .area-btn{margin:4px 0 12px 0;text-align:center;}#area-toolbar-view .config-box .inner .area-btn .btn{float:none;font-size:18px;height:34px;line-height:32px;padding:0 12px;}#area-toolbar-view .config-box .inner .area-btn .btn:hover .icon{color:#95be3e}#area-toolbar-view .config-box .inner .area-btn .btn .icon{color:#3a9bd9}#area-toolbar-view .config-box .inner label{font-size:16px;color:#899619;display:inline-block;line-height:1.2;margin:0 30px 0 10px}#area-toolbar-view .config-box .inner input[type="checkbox"]{vertical-align:text-bottom;width:20px;box-shadow:none;height:20px;cursor:pointer}');$("head").append(style);$("#area-toolbar-view").append('<a class="tooltip"><i class="icon icon-star"></i>AcFun助手</a>').append('<div class="config-box">'+'<div class="inner">'+'<div class="area-btn"><a class="btn" id="swap-player"><i class="icon icon-heart"></i>点击手动替换播放器</a></div>'+'<div><label for="auto-swap">自动替换播放器</label><input id="auto-swap" type="checkbox" checked="checked"></div>'+'<div><label for="auto-hide">自动隐藏插件</label><input id="auto-hide" type="checkbox"></div>'+'<div><label for="use-html5">使用HTML5播放器</label><input id="use-html5" type="checkbox"></div>'+"</div></div>"+"</div>");if(!config.plugins.acHelper.autoHide){$("#area-toolbar-view").find(".tooltip").css({display:"inline-block"})}else{$("#auto-hide")[0].checked=true}if(!config.plugins.acHelper.autoSwap){$("#auto-swap")[0].checked=false}if(config.plugins.acHelper.html5){$("#use-html5")[0].checked=true}$("#swap-player").on("click",function(){from=$("#area-part-view .btn.active").data().from;if($.inArray(from,["youku2","qq2","letv2","sohu","pptv","iqiyi"])!==-1||$("object#ACFlashPlayer-re").length){$("#area-part-view .btn.active").data().from="acer";if(system.func.readyPlayer){$("#area-player .inner").html('<iframe id="ACFlashPlayer-re"></iframe>');system.func.readyPlayer()}else{system.func.setPlayer()}}else{$(this).info("info::播放器已替换或替换失败。")}});$("#auto-swap").on("change",function(){if(this.checked){config.plugins.acHelper.autoSwap=true}else{config.plugins.acHelper.autoSwap=false}$.save("config")});$("#auto-hide").on("change",function(){if(this.checked){config.plugins.acHelper.autoHide=true}else{config.plugins.acHelper.autoHide=false}$.save("config")});$("#use-html5").on("change",function(){if(this.checked){config.plugins.acHelper.html5=true;system.func.checkFlash=function(){return false}}else{config.plugins.acHelper.html5=false;system.func.checkFlash=function(){return true}}$.save("config")})})();